SobiPro.jQuery(document).ready(function(){SobiPro.jQuery('.ctrl-entry-reject').SobiProRejections()});SobiPro.jQuery.fn.SobiProRejections=function(){var f=this;this.Templates;this.header;this.RemoveButton=false;this.Sid;var g=SobiPro.jQuery('#reject-entry-window');this.click(function(e){e.preventDefault();g.modal();if(g.find('select').children('option').length==0){f.GetTemplates()}if(!(f.header)){f.header=g.find('.modal-header').find('h3').html()}f.Sid=SobiPro.jQuery(this).parent().parent().find('[name="e_sid[]"]').val();g.find('.modal-header').find('h3').html(f.header+' - '+SobiPro.jQuery(this).parent().parent().find('.entry-name').find('a').html())});this.GetTemplates=function(){g.find('select').after('<span class="spinner-remove">&nbsp;<i class="icon-spinner icon-spin"></i></span>');g.find('select').find('option').remove().end();var b={'option':'com_sobipro','task':'config.rejectionTemplates','sid':SobiProSection,'format':'raw','tmpl':'component','method':'xhr'};SobiPro.jQuery.ajax({url:'index.php',type:'post',dataType:'json',data:b}).done(function(a){f.Templates=a;SobiPro.jQuery.each(a,function(i,e){g.find('select').append(new Option(e.value,i))});if(!(f.RemoveButton)){f.RemoveButton=true;g.find('select').after('&nbsp;&nbsp;<a class="btn btn-small btn-danger ctrl-remove-tpl" "><i class="icon-trash"></i></a>');SobiPro.jQuery('.ctrl-remove-tpl').click(function(){f.RemoveTemplate()})}f.GetTemplate();g.find('.spinner-remove').detach()})};this.RemoveTemplate=function(){var c=g.find('select').find(':selected').val();if(c&&confirm(SobiPro.Txt('ENTRY_REJECT_TEMPLATE_DELETE'))){var d={'option':'com_sobipro','task':'config.deleteRejectionTemplate','sid':SobiProSection,'tid':c,'format':'raw','tmpl':'component','method':'xhr'};SobiPro.jQuery(g.find(':input')).each(function(i,b){var a=SobiPro.jQuery(b);d[a.attr('name')]=a.val()});SobiPro.jQuery.ajax({url:'index.php',type:'post',dataType:'json',data:d}).done(function(a){alert(a.message.text);f.GetTemplates()})}};this.GetTemplate=function(){var a=g.find('select').find(':selected').val();if(a&&this.Templates[a]){g.find('[name="reason"]').val(this.Templates[a].description);g.find('[name="trigger.unpublish"]').button('toggle');SobiPro.jQuery.each(this.Templates[a].params,function(i,e){if(e){g.find('[name="'+i+'"][value="1"]').addClass('btn-success active');g.find('[name="'+i+'"][value="0"]').removeClass('btn-danger active selected')}else{g.find('[name="'+i+'"][value="0"]').addClass('btn-danger active');g.find('[name="'+i+'"][value="1"]').removeClass('btn-success active selected')}})}};g.find('select').change(function(){f.GetTemplate()});g.find('.ctrl-reject').click(function(e){e.preventDefault();var c={'option':'com_sobipro','task':'entry.reject','sid':f.Sid,'format':'raw','tmpl':'component','method':'xhr'};SobiPro.jQuery(this).html(SobiPro.jQuery(this).html()+'<span class="spinner-remove">&nbsp;<i class="icon-spinner icon-spin"></i></span>');SobiPro.jQuery(g.find(':input')).each(function(i,b){var a=SobiPro.jQuery(b);c[a.attr('name')]=a.val()});SobiPro.jQuery(g.find(':button')).each(function(i,b){var a=SobiPro.jQuery(b);if(a.hasClass('active')){c[a.attr('name')]=a.val()}});SobiPro.jQuery.ajax({url:'index.php',type:'post',dataType:'json',data:c}).done(function(a){if(a.redirect.execute){window.location.replace(a.redirect.url)}else{alert(a.message.text)}})});g.find('.ctrl-save-tpl').click(function(e){e.preventDefault();var c=window.prompt(SobiPro.Txt('ENTRY_REJECT_TEMPLATE_NAME_PROMPT'),g.find('select').find(':selected').text());if(c&&c.length){var d={'option':'com_sobipro','task':'config.saveRejectionTpl','templateName':c,'sid':SobiProSection,'format':'raw','tmpl':'component','method':'xhr','reason':g.find('textarea').val()};SobiPro.jQuery(g.find(':input')).each(function(i,b){var a=SobiPro.jQuery(b);d[a.attr('name')]=a.val()});SobiPro.jQuery(g.find(':button')).each(function(i,b){var a=SobiPro.jQuery(b);if(a.hasClass('active')){d[a.attr('name')]=a.val()}});SobiPro.jQuery.ajax({url:'index.php',type:'post',dataType:'json',data:d}).done(function(a){alert(a.message.text);f.GetTemplates()})}})};
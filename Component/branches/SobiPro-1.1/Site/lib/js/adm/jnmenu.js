var SobiProUrl='';SobiPro.jQuery(document).ready(function(){var h=SobiPro.jQuery('#SobiProModal');SobiPro.jQuery('#jform_link').css('min-width','400px');h.find('.ctrl-save').click(function(e){e.preventDefault();var c=h.find('iframe').contents().find(':input');var d={};var f=[];SobiPro.jQuery.each(c,function(i,e){e=SobiPro.jQuery(e);switch(e.attr('name')){case'sid':SobiPro.jQuery('#selectedSid').val(e.val());break;case'function-name':var a=e.val();if(a.indexOf('%s')!=-1){a=a.replace('%s',SobiPro.jQuery("#SobiSection").find(':selected').text())}SobiPro.jQuery('#SobiProSelectedFunction').html(a);break;default:if(e.attr('name').indexOf('params')!=-1){var b=e.attr('name').replace('params[','').replace(']','');d[b]=e.val()}else if(e.attr('name').indexOf('request')!=-1){var b=e.attr('name').replace('request[','').replace(']','');f.push({'name':b,'value':e.val()})}break}});if(f.length){var g='index.php?option=com_sobipro&';SobiPro.jQuery.each(f,function(i,e){if(e.value.length){g=g+e.name+'='+e.value;if(i+1<f.length){g=g+'&'}}});SobiProUrl=g;SPUpdateUrl()}SobiPro.jQuery('.SobiProSettings').val(SobiPro.jQuery.base64.encode(JSON.stringify(d)))});h.find('.ctrl-clear').click(function(e){SobiProUrl='';SPUpdateUrl();SobiPro.jQuery('#SobiProSelectedFunction').html(SpStrings.buttonLabel)});SobiPro.jQuery('#SobiProSelector').bind('click',function(e){if(SobiPro.jQuery("#SobiSection").val()==0||SobiPro.jQuery("#SobiSection").val()==""){SobiPro.Alert('YOU_HAVE_TO_AT_LEAST_SELECT_A_SECTION');return false}h.modal();var a=SobiPro.jQuery('#SobiProSelector').data('mid');var b=SobiPro.jQuery('#SobiSection').val();h.find('.modal-body').html('<iframe src="index.php?option=com_sobipro&section='+b+'&task=menu&tmpl=component&format=html&mid='+a+'" style="width: 480px; height: 400px; border: none;"> </iframe>')});try{var j=Joomla.submitbutton;Joomla.submitbutton=function(a,b){if(a.indexOf('save').indexOf==-1||a.indexOf('apply')==-1||SPValidate()){j(a,b)}}}catch(x){var j=submitbutton;submitbutton=function(a,b){if(a.indexOf('save').indexOf==-1||a.indexOf('apply')==-1||SPValidate()){j(a,b)}}}SobiPro.jQuery('#SobiProFunctions').change(function(){if(SobiPro.jQuery(this).val()){SobiPro.jQuery('body').find('form').submit()}});SobiPro.jQuery('.SobiProCalendar').change(function(){"use strict";var a=[];SobiPro.jQuery('.SobiProCalendar').each(function(i,e){if(SobiPro.jQuery(this).val()){a.push(SobiPro.jQuery(this).val())}});SobiPro.jQuery('[name=request\\[date\\]]').val(a.join('.'))});SobiPro.jQuery('.SobiProEntryChooser').typeahead({source:function(b,c){var d={'option':'com_sobipro','task':'entry.search','sid':SobiPro.jQuery('#SP_section').val(),'search':c,'format':'raw'};return SobiPro.jQuery.ajax({'type':'post','url':'index.php','data':d,'dataType':'json',success:function(a){responseData=[];if(a.length){for(var i=0;i<a.length;i++){responseData[i]={'name':a[i].name+' ( '+a[i].id+' )','id':a[i].id,'title':a[i].name}}b.process(responseData)}}})},onselect:function(a){SobiPro.jQuery('#SP_sid').val(a.id);SobiPro.jQuery('#selectedEntryName').val(a.title);SobiPro.jQuery('input[name=function-name]').val(SobiPro.jQuery('#entryName').html().replace('%s',a.title))},property:"name"});try{SobiPro.jQuery(SobiPro.jQuery('#jform_type-lbl').siblings()[0]).val(SpStrings.component)}catch(e){}try{var k=SobiPro.jQuery('[name*="jform[type]"]').parent().find('input[type=text]');k.val(SpStrings.component);k.css('min-width','200px');SobiPro.jQuery('#jform_link').css('min-width','500px')}catch(e){}});function SP_selectCat(d){SobiPro.jQuery('input[name*=sid]').val(d);SobiPro.jQuery('#sobiCats_CatUrl'+d).focus();SobiPro.jQuery.ajax({'url':'index.php','data':{'task':'category.parents','out':'json','option':'com_sobipro','format':'raw','tmpl':'component','sid':d},'type':'post','dataType':'json'}).done(function(b){var c='';SobiPro.jQuery.each(b.categories,function(i,a){c=a.name});SobiPro.jQuery('input[name=function-name]').val(SobiPro.jQuery('#categoryName').html().replace('%s',c))})}function SPUpdateUrl(){if(!(SobiPro.jQuery('#selectedSid').val())){SobiPro.jQuery('#selectedSid').val(SobiPro.jQuery('#SobiSection').val())}if(SobiProUrl==''){SobiProUrl='index.php?option=com_sobipro&sid='+SobiPro.jQuery('#selectedSid').val();SobiPro.jQuery('.SobiProSettings').val('')}SobiPro.jQuery('#jform_link').val(SobiProUrl)}function SPValidate(){SPUpdateUrl();if(SobiPro.jQuery("#selectedSid").val()==0||SobiPro.jQuery("#selectedSid").val()==""){SobiPro.Alert('YOU_HAVE_TO_AT_LEAST_SELECT_A_SECTION');return false}else{return true}}
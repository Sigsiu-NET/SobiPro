SobiPro.jQuery().ready(function(){"use strict";var k='';SobiPro.jQuery('#SPAdminForm').on('BeforeAjaxSubmit',function(e,a,b){if(b=='extensions.fetch'){a.takeOver=true;SPSetCookie('');setTimeout(SPProgressMessage,50);SobiPro.jQuery('#SpProgress').removeClass('hide');SobiPro.jQuery('#SpProgress .bar').css('width','1%');var c=SobiPro.jQuery('#SP_method').next('input');var d=SobiProAdmUrl.replace('%task%',b)+'&'+c.attr('name')+'='+c.val();SobiPro.jQuery.ajax({'type':'get','url':d,'dataType':'json'})}});SobiPro.jQuery('.SpAddRepo').click(function(){new SpRepositoryInstall()});function SpRepositoryInstall(){this.repository=SobiPro.jQuery('[name="RepositoryURL"]').val();var d=this;this.error=function(a){var b='<div class="alert alert-'+a.type+'"><a class="close" data-dismiss="alert" href="#">Ã—</a>'+a.text+'</div>';SobiPro.jQuery('#spMessage').removeClass('alert-info').html(b)};this.request=function(b,c){SobiPro.jQuery.ajax({'type':'post','url':'index.php','data':b,'dataType':'json',success:function(a){c(a,b)}})};this.addRepo=function(a,b){if(a.message.type=='error'){d.error(a.message)}else{SobiPro.jQuery(a.message.response).appendTo(SobiPro.jQuery('#SobiPro'));SobiPro.jQuery('#SpRepoModal').find('.modal').modal();SobiPro.jQuery('#SpRepoModal').find('.confirm').click(function(){SobiPro.jQuery('#SpRepoModal').remove();b['task']='extensions.confirmRepo';d.request(b,d.repoCallback)})}};this.repoCallback=function(b,c){if(b.message.type=='error'){d.error(b.message)}else{SobiPro.jQuery(b.message.response).appendTo(SobiPro.jQuery('#SobiPro'));SobiPro.jQuery('#SpRepoModal').find('.modal').modal();if(b.repository!=undefined){c['repository']=b.repository}if(b.callback){SobiPro.jQuery('#SpRepoModal').find('.confirm').click(function(){c['task']='extensions.registerRepo';c['callback']=b.callback;var a=SobiPro.jQuery('#SpRepoModal').find('form').serializeArray();for(var i=0;i<a.length;i++){c[a[i]['name']]=a[i]['value']}SobiPro.jQuery('#SpRepoModal').remove();d.request(c,d.repoCallback)})}else{if(b.redirect){alert(b.message.response.replace(/<br\s*[\/]?>/gi,"\n"));window.location.reload()}}}};if(this.repository==''){SobiPro.Alert('NO_REPO')}else{var e=SobiPro.jQuery('#SP_method').next('input');var f={'option':'com_sobipro','task':'extensions.addRepo','method':'xhr','format':'raw','repository':this.repository};f[e.attr('name')]=e.val();this.request(f,this.addRepo)}}function SPProgressMessage(){SobiPro.jQuery.ajax({'type':'get','url':SobiProAdmUrl.replace('%task%','progress'),'dataType':'json',success:function(a){if(k!=a.type){SobiPro.jQuery('#SpProgress .alert').removeClass(k).removeClass('alert-info').addClass('alert-'+a.type);k='alert-'+a.type}SobiPro.jQuery('#SpProgress .alert').html(a.message);SobiPro.jQuery('#SpProgress .bar').css('width',a.progress+'%');if(a.progress<100&&a.type!='error'){setTimeout(SPProgressMessage,a.interval)}else{if(a.type!='error'){window.location.reload()}}}})}SobiPro.jQuery('.SpExtInstall').click(function(){new SpExtInstall(SobiPro.jQuery(this).parent(),SobiPro.jQuery(this).attr('rel'))});SobiPro.jQuery('.SpRemoveRepo').click(function(){var b=SobiPro.jQuery(this).attr('rel');var c=SobiPro.jQuery('#SP_method').next('input');var d={'option':'com_sobipro','task':'extensions.delRepo','method':'xhr','format':'raw','repository':b};d[c.attr('name')]=c.val();SobiPro.jQuery.ajax({'type':'post','url':'index.php','data':d,'dataType':'json',success:function(a){window.location.replace(a.redirect.url)}})});function SpExtInstall(f,g){this.ident=g.replace(/\./g,'-');this.canvas=f;f.html('<div id="'+this.ident+'"><div class="progress"><div class="bar" style="width: 1%;"></div></div></div>');SPSetCookie(this.ident);var h=SobiPro.jQuery('#SP_method').next('input');var i=SobiProAdmUrl.replace('%task%','extensions.download')+'&exid='+g+'&session='+this.ident+'&'+h.attr('name')+'='+h.val();this.progressBar=SobiPro.jQuery('#'+this.ident).find('.bar');var j=this;this.progress=function(){SobiPro.jQuery.ajax({'type':'get','url':SobiProAdmUrl.replace('%task%','progress')+'&session='+j.ident,'dataType':'json',success:function(a){SobiPro.DebOut(a);if(a.type!='info'&&a.type!='success'){var b=a.type=='error'?'important':a.type;var c='<p><span class="label label-'+b+'">'+a.typeText+'&nbsp;</span></p>';var d='<div class="modal hide" id="'+j.ident+'Modal"><div class="modal-body">'+c+'<div>'+a.message+'</div></div><div class="modal-footer"><a href="#" class="btn" data-dismiss="modal">OK</a></div></div>';SobiPro.jQuery(d).appendTo(j.canvas);var e=SobiPro.jQuery('#'+j.ident+'Modal').modal();SobiPro.jQuery('#'+j.ident+'Modal').find('.btn').click(function(){e.modal('hide')})}SobiPro.jQuery(j.progressBar).css('width',a.progress+'%');SobiPro.jQuery(j.progressBar).html(a.progress+'%');if(a.progress<100&&a.type!='error'){setTimeout(function(){j.progress()},a.interval)}}})};SobiPro.jQuery.ajax({'type':'get','url':i,'dataType':'json'});setTimeout(function(){j.progress()},500)}function SPSetCookie(a){var b=new Date();b.setHours(b.getHours()+1);var c=b.getTime()+Math.floor(Math.random()*11)*100;document.cookie="SPro_ProgressMsg"+a+"="+c+";expires="+b.toUTCString()+";path=/"}try{SobiPro.jQuery('#repositoryurl').keydown(function(e){if(e.keyCode==13){e.preventDefault();setTimeout(function(){SobiPro.jQuery('.SpAddRepo').click()},100)}})}catch(e){}});function SPExtensionInstaller(){window.location.reload()}

SobiPro.jQuery(document).ready(function(){SobiPro.jQuery('input:file').change(function(){if(!(SobiPro.jQuery(this).hasClass('spFileUploadHidden'))&&SobiPro.jQuery(this).val()){SobiPro.jQuery('#SP_method').val('html')}});function SpSerialAction(l){var m=[];var n=this;this.counter=0;this.doneCounter=0;this.progressBar=SobiPro.jQuery('#SpProgress').find('.bar');this.progressMessage=SobiPro.jQuery('#SpProgress .alert');this.messages={'warning':[],'error':[],'info':[],'success':[]};this.finish=function(j){var k={'option':'com_sobipro','task':'txt.messages','format':'raw','method':'xhr','spsid':SobiPro.jQuery('#SP_spsid').val()};SobiPro.jQuery.ajax({'url':'index.php','data':k,'type':'post','dataType':'json',success:function(d){if(d&&d.data.messages.length){for(var i=0;i<d.data.messages.length;i++){n.messages[d.data.messages[i].type].push(d.data.messages[i].text)}}var e=0;var f=[];SobiPro.jQuery.each(n.messages,function(a,b){var c=[];for(var i=0;i<b.length;i++){e++;c.push('<div><strong> '+e+')&nbsp;</strong>'+b[i]+'</div>')}if(c.length){f.push('<div class="smallmessage alert-'+a+' alert">'+c.join("\n")+'</div>')}});if(e>0){var g='<div class="modal hide" id="SpModalMsg"><div class="modal-body">'+f.join("\n")+'</div><div class="modal-footer"><a href="#" class="btn" data-dismiss="modal">OK</a></div></div>';SobiPro.jQuery(g).appendTo(SobiPro.jQuery('#SobiPro'));var h=SobiPro.jQuery('#SpModalMsg').modal();h.on('hidden',function(){n.refresh(j)})}else{n.refresh(j)}}})};this.progress=function(a){this.doneCounter++;this.progressBar.css('width',100/(this.counter-this.doneCounter+1)+'%');this.messageType(a.message.type);this.progressMessage.html(a.message.text);var b=a.redirect.url;if(a.message.type!='success'){this.messages[a.message.type].push(a.message.text)}if(this.doneCounter==this.counter){this.finish(b)}};this.refresh=function(a){this.messageType('info');this.progressMessage.html(SobiPro.Txt('PROGRESS_DONE_REDIRECTING'));window.location.replace(a)};this.messageType=function(a){this.progressMessage.removeClass('alert alert-info alert-success alert-error').addClass('alert alert-'+a)};SobiPro.jQuery('[name="e_sid[]"]').each(function(i,e){var a=SobiPro.jQuery(e);if(a.prop('checked')){m.push(a)}});if(m.length){this.counter=m.length;this.progressMessage.html(SobiPro.Txt('PROGRESS_WORKING'));SobiPro.jQuery('#SpProgress').removeClass('hide');this.progressBar.css('width','0%');var o={'option':'com_sobipro','task':l,'format':'raw','method':'xhr','spsid':SobiPro.jQuery('#SP_spsid').val()};for(var i=0;i<m.length;i++){o['sid']=m[i].val();SobiPro.jQuery.ajax({'url':'index.php','data':o,'type':'post','dataType':'json',success:function(a){n.progress(a)}})}}}var p=0;var q=['entry.publish','entry.hide','entry.approve','entry.unapprove'];SobiPro.jQuery('#SPAdmToolbar a').click(function(e){if(SobiPro.jQuery(this).attr('title')){if(!(confirm(SobiPro.jQuery(this).attr('title')))){e.preventDefault();e.stopPropagation();return false}}if(SobiPro.jQuery(this).hasClass('legacy')){return false}var f=SobiPro.jQuery(this).attr('rel');SobiPro.jQuery('#SP_task').val(f);if(f.length){e.preventDefault();e.stopPropagation();if(SobiPro.jQuery.inArray(f,q)!=-1){SobiPro.jQuery(this).parent().parent().parent().parent().removeClass('open');return new SpSerialAction(f)}else if(SobiPro.jQuery('#SP_method').val()=='xhr'){var g={'takeOver':false};SobiPro.jQuery('#SPAdminForm').trigger('BeforeAjaxSubmit',[g,f]);if(g.takeOver==true){return true}SPTriggerFrakingWYSIWYGEditors();var h=SobiPro.jQuery('#SPAdminForm').serialize();SobiPro.jQuery(SobiPro.jQuery('#SPAdminForm').find(':button')).each(function(i,b){bt=SobiPro.jQuery(b);if(bt.attr('disabled')!='disabled'&&bt.hasClass('active')){h+='&'+bt.attr('name')+'='+bt.val()}});SobiPro.jQuery('#SP_task').val(f);SobiPro.jQuery.ajax({'url':'index.php','data':h,'type':'post','dataType':'json',success:function(b){if(!(b.redirect.execute)){var d={'takeOver':false};SobiPro.jQuery('#SPAdminForm').trigger('AfterAjaxSubmit',[d,b]);if(d.takeOver==true){return true}p++;c='';if(p>1){c='&nbsp;('+p+')'}alert='<div class="alert alert-'+b.message.type+'"><a class="close" data-dismiss="alert" href="#">Ã—</a>'+b.message.text+c+'</div>';SobiPro.jQuery('#spMessage').html(alert);try{SobiPro.jQuery.each(b.data.sets,function(i,a){SobiPro.jQuery('[name^="'+i+'"]').val(a)})}catch(e){}if(b.data.required){SobiPro.jQuery('[name*="'+b.data.required+'"]').addClass('error').attr('required','required').focus().focusout(function(){if(SobiPro.jQuery(this).val()){SobiPro.jQuery(this).removeClass('error').removeAttr('required').addClass('success')}})}}else{window.location.replace(b.redirect.url)}}})}else{SobiPro.jQuery('#SPAdminForm').submit()}}});SobiPro.jQuery('.spOrdering').change(function(){SobiPro.jQuery('#SPAdminForm').submit()});SobiPro.jQuery('[name="spToggle"]').change(function(){SobiPro.jQuery('[name="'+SobiPro.jQuery(this).attr('rel')+'[]"]').prop('checked',SobiPro.jQuery(this).is(':checked'))});SobiPro.jQuery('[name="spReorder"]').click(function(e){e.preventDefault();SobiPro.jQuery('#SP_task').val(SobiPro.jQuery(this).attr('rel')+'.reorder');SobiPro.jQuery('#SPAdminForm').submit()});try{SobiPro.jQuery('.counter-reset').each(function(i,e){"use strict";var a=SobiPro.jQuery(e);if(a.html()==0){a.attr('disabled','disabled')}})}catch(e){}SobiPro.jQuery('.counter-reset').click(function(){var a=SobiPro.jQuery(this);var b=SobiPro.jQuery('#SP_sid').val()?SobiPro.jQuery('#SP_sid').val():SobiPro.jQuery('[name^="category.id"]').val();if(a.html()){SobiPro.jQuery.ajax({'type':'post','url':SobiProAdmUrl.replace('%task%',a.attr('rel')+'.resetCounter'),'data':{'sid':b,'format':'raw'},'dataType':'json',success:function(){a.html(0);a.attr('disabled','disabled')}})}else{a.attr('disabled','disabled')}});function SPTriggerFrakingWYSIWYGEditors(){var a=['unload','onbeforeunload','onunload'];for(var i=0;i<a.length;i++){try{window.dispatchEvent(a[i])}catch(e){}try{window.fireEvent(a[i])}catch(e){}try{SobiPro.jQuery(document).triggerHandler(a[i])}catch(e){}}try{tinyMCE.triggerSave()}catch(e){}}SobiPro.jQuery('.spSubmit').keydown(function(e){"use strict";if(e.keyCode==13){e.preventDefault();e.stopPropagation();SobiPro.jQuery('#SPAdminForm').submit()}});SobiPro.jQuery('.spDisableEnter').keydown(function(e){"use strict";if(e.keyCode==13){e.preventDefault();e.stopPropagation()}});SobiPro.jQuery('.buttons-radio :button').each(function(i,e){var e=SobiPro.jQuery(e);if(!(e.hasClass('selected'))){e.removeClass('btn-success').removeClass('btn-danger')}e.click(function(){SobiPro.jQuery(e).parent().parent().find('.buttons-radio :button').removeClass('btn-danger').removeClass('btn-success');switch(parseInt(SobiPro.jQuery(this).val())){case 0:e.addClass('btn-danger');break;case 1:e.addClass('btn-success');break}})});try{SobiPro.jQuery('#spcfg-general-show-pb').click(function(){if(SobiPro.jQuery(this).find('.active').val()==1){SobiPro.Alert('PBY_NO')}})}catch(e){}try{SobiPro.jQuery('#spcfg-debug-xml-ip').click(function(){if(SobiPro.jQuery(this).val()==''){SobiPro.jQuery(this).val(SobiPro.jQuery('#SP_current-ip').val())}})}catch(e){}if(SobiPro.jQuery('.spFileUpload').length){SobiPro.jQuery('.spFileUpload').SPFileUploader()}});

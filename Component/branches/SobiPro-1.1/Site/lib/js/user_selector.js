SobiPro.jQuery(document).ready(function(){new SpUserSelector()});function d(){"use strict";var d=this;var f=1;var g=null;var h=null;var j=false;var k=0;var l=null;var m='';SobiPro.jQuery('.SobiPro .spUserSelector .trigger').click(function(a){if(this.semaphor){return true}this.semaphor=true;d.modal=SobiPro.jQuery(this).parent().parent().find('.modal');d.form=SobiPro.jQuery(this).parent().parent().find(':input[type=hidden]');d.responseContainer=d.modal.find('.response');d.getUsers(d.getForm(d.form),d.modal);d.modal.find('.save').click(function(){if(d.selected){SobiPro.jQuery(this).parent().parent().parent().find('[rel^="selected"]').val(d.selected['id']);SobiPro.jQuery(this).parent().parent().parent().find('.user-name').val(d.selected['text'])}});d.modal.modal();var b=this;d.modal.on('hidden',function(){b.semaphor=0;d.modal.find('.response').html('');d.site=1;d.active=false})});SobiPro.jQuery('.spUserSelector .more').click(function(){var a=d.getForm(d.form);a['site']=++d.site;a['q']=d.query;d.getUsers(a)});SobiPro.jQuery('.spUserSelector .search').keyup(function(){var a=d.getForm(d.form);a['q']=SobiPro.jQuery(this).val();d.query=a['q'];d.modal.find('.response').html('');a['site']=1;d.getUsers(a)});this.getForm=function(b){var c={'site':this.site};b.each(function(i,e){var a=SobiPro.jQuery(e);if(a.attr('rel')=='selected'){c['selected']=a.val();d.selected=c['selected']}else{if(a.attr('name').indexOf('Ssid')!=-1){c['ssid']=a.val()}else{c[a.attr('name')]=a.val()}}});return c};this.getUsers=function(c){SobiPro.jQuery.ajax({'type':'post','url':SobiProUrl.replace('%task%','user.search'),'data':c,'dataType':'json',success:function(b){d.site=b.site;if(b.sites>b.site){d.modal.find('.more').removeClass('hide')}else{d.modal.find('.more').addClass('hide')}b.users.each(function(e){var a='';if(e.id==d.selected&&!(d.active)){a=' btn-success active'}d.responseContainer.html(d.responseContainer.html()+'<div class="spUserName"><button class="btn btn-small'+a+'" type="button" value="'+e.id+'" name="userSelect">'+e.text+'</button></div>')});d.responseContainer.find('.btn').click(function(){d.active=true;d.selected={'id':SobiPro.jQuery(this).val(),'text':SobiPro.jQuery(this).html()};d.responseContainer.find('.btn').removeClass('active');d.responseContainer.find('.btn').removeClass('btn-success');SobiPro.jQuery(this).addClass('btn-success')})}})}}
